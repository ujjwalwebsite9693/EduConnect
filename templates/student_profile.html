{% extends "base.html" %}

{% block nav_links %}
<li class="nav-item"><a class="nav-link" href="{{ url_for('student_dashboard') }}"><b>Dashboard</b></a></li>
<li class="nav-item"><a class="nav-link" href="{{ url_for('student_results') }}"><b>Results</b></a></li>
<li class="nav-item"><a class="nav-link active" href="{{ url_for('student_profile') }}"><b>Profile</b></a></li>
{% endblock %}

{% block content %}
<div class="fade">

    <h3 class="fw-bold mb-3">My Profile</h3>

    <div class="glass-card profile-box mx-auto">

        <!-- Avatar -->
        <div class="text-center">
            <div class="avatar-preview mx-auto mb-3">
                {% if profile.profile_pic %}
                    <img src="{{ url_for('static', filename='../../uploads/avatars/' + profile.profile_pic) }}"
                         class="img-fluid rounded-circle" style="width:100%;height:100%;">
                {% else %}
                    <div class="d-flex justify-content-center align-items-center h-100 text-white fw-bold"
                         style="font-size:2rem;background:var(--accent);border-radius:50%;">
                         {{ profile.name[0] }}
                    </div>
                {% endif %}
            </div>

            <h5 class="fw-bold">{{ profile.name }}</h5>
            <p class="text-muted small mb-3">@{{ profile.username }}</p>
        </div>

        <hr>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div class="alert alert-{{ category }} mb-2">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- FORM -->
        <form method="POST" enctype="multipart/form-data">

            <!-- Name -->
            <label class="fw-bold small">Full Name</label>
            <input type="text" name="name" value="{{ profile.name }}" class="form-control mb-3">

            <!-- Username -->
            <label class="fw-bold small">Username</label>
            <input type="text" name="username" value="{{ profile.username }}" class="form-control mb-3">

            <!-- Password -->
            <label class="fw-bold small">New Password</label>
            <input type="password" name="password" placeholder="Leave blank to keep existing"
                   class="form-control mb-3">

            <label class="fw-bold small">Confirm Password</label>
            <input type="password" name="confirm_password" placeholder="Repeat new password"
                   class="form-control mb-3">

            <!-- Avatar Upload -->
            <label class="fw-bold small">Profile Picture</label>
            <div class="upload-dropzone mb-3">
                <input type="file" name="avatar" accept=".jpg,.jpeg,.png">
                Click to upload JPG/PNG image
            </div>

            <button class="btn btn-accent w-100">Save Changes</button>

        </form>

    </div>

</div>
{% endblock %}
